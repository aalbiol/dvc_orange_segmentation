schema: '2.0'
stages:
  split_train_val:
    cmd: python ../src_view_segmentation/data/split_train_val.py config/config.yaml
    deps:
    - path: ../src_view_segmentation/data/split_train_val.py
      hash: md5
      md5: 5de64fb4159896e4abf92e00bd424c2e
      size: 2978
    params:
      config/config.yaml:
        data:
          prob_train: 0.8
          training_size:
          - 150
          - 150
          crop_size:
          delimiter: _
          maxvalues:
          - 255
          - 1023
          - 1023
          root_folder: data
          suffixes:
          - _RGB.png
          - _NIR.png
          - _UV.png
          channel_list:
          use_segmentation_masks: true
          train:
          - - train_list.txt
            - 20240219_190526_Img_20240219_NaranjaRottEncoder/jsons
            - 20240219_190526_Img_20240219_NaranjaRottEncoder/images
          - - train_list.txt
            - 20240220_142555_Img_20240220_goods/jsons
            - 20240220_142555_Img_20240220_goods/images
          - - train_list.txt
            - 20240312_210918_prod/jsons
            - 20240312_210918_prod/images
          - - train_list.txt
            - 20240312_210929_prod/jsons
            - 20240312_210929_prod/images
          - - train_list.txt
            - 20240321_162918_Img_20240321_162913/jsons
            - 20240321_162918_Img_20240321_162913/images
          - - train_list.txt
            - 20240321_172502_defectos_rotando/jsons
            - 20240321_172502_defectos_rotando/images
          - - train_list.txt
            - 20240805/jsons
            - 20240805/images
          val:
          - - val_list.txt
            - 20240219_190526_Img_20240219_NaranjaRottEncoder/jsons
            - 20240219_190526_Img_20240219_NaranjaRottEncoder/images
          - - val_list.txt
            - 20240220_142555_Img_20240220_goods/jsons
            - 20240220_142555_Img_20240220_goods/images
          - - val_list.txt
            - 20240312_210918_prod/jsons
            - 20240312_210918_prod/images
          - - val_list.txt
            - 20240312_210929_prod/jsons
            - 20240312_210929_prod/images
          - - val_list.txt
            - 20240321_162918_Img_20240321_162913/jsons
            - 20240321_162918_Img_20240321_162913/images
          - - val_list.txt
            - 20240321_172502_defectos_rotando/jsons
            - 20240321_172502_defectos_rotando/images
          - - val_list.txt
            - 20240805/jsons
            - 20240805/images
    outs:
    - path: data/20240219_190526_Img_20240219_NaranjaRottEncoder/jsons/train_list.txt
      hash: md5
      md5: a51fd20c44a182d6b5434af3c5251def
      size: 11339
    - path: data/20240219_190526_Img_20240219_NaranjaRottEncoder/jsons/val_list.txt
      hash: md5
      md5: 62af79317a016f2fca6ca5823da432bd
      size: 4727
    - path: data/20240220_142555_Img_20240220_goods/jsons/train_list.txt
      hash: md5
      md5: 7e4ffdf6260c2aedeef3d49e3ed4c146
      size: 8874
    - path: data/20240220_142555_Img_20240220_goods/jsons/val_list.txt
      hash: md5
      md5: f6945bfda5b247f173b95030942722f8
      size: 1914
    - path: data/20240312_210918_prod/jsons/train_list.txt
      hash: md5
      md5: c309363fa76455d1247bb39f57027ce2
      size: 34771
    - path: data/20240312_210918_prod/jsons/val_list.txt
      hash: md5
      md5: 07a6c4b1cf3e3a9d18249b146463aa3b
      size: 8845
    - path: data/20240312_210929_prod/jsons/train_list.txt
      hash: md5
      md5: 6fc606e91df38d80555ab643a905368e
      size: 26999
    - path: data/20240312_210929_prod/jsons/val_list.txt
      hash: md5
      md5: 7ba83e904e624847e3ba2e3c88062494
      size: 7627
    - path: data/20240321_162918_Img_20240321_162913/jsons/train_list.txt
      hash: md5
      md5: 5ffdf6c59e5fc3dc5ceb65142736620b
      size: 9744
    - path: data/20240321_162918_Img_20240321_162913/jsons/val_list.txt
      hash: md5
      md5: f050e39bfa8177cf6397a6bdf3dc9a46
      size: 2349
    - path: data/20240321_172502_defectos_rotando/jsons/train_list.txt
      hash: md5
      md5: f8461d2689fc5455960db08c18127ee3
      size: 5539
    - path: data/20240321_172502_defectos_rotando/jsons/val_list.txt
      hash: md5
      md5: 77492d59412d9df37e382f89af48a955
      size: 1218
    - path: data/20240805/jsons/train_list.txt
      hash: md5
      md5: 77a5c1e1c14ab448f8cefcaa8e357062
      size: 64264
    - path: data/20240805/jsons/val_list.txt
      hash: md5
      md5: 7a417b077a5836708de8b811d27389ee
      size: 16733
  train:
    cmd: python ../src_view_segmentation/train/trainMIL.py config/config.yaml
    deps:
    - path: ../src_view_segmentation/train/trainMIL.py
      hash: md5
      md5: ec1b6db22c0c3d1ee360082d2c0931f3
      size: 3221
    params:
      config/config.yaml:
        data:
          prob_train: 0.8
          training_size:
          - 150
          - 150
          crop_size:
          delimiter: _
          maxvalues:
          - 255
          - 1023
          - 1023
          root_folder: data
          suffixes:
          - _RGB.png
          - _NIR.png
          - _UV.png
          channel_list:
          use_segmentation_masks: true
          train:
          - - train_list.txt
            - 20240219_190526_Img_20240219_NaranjaRottEncoder/jsons
            - 20240219_190526_Img_20240219_NaranjaRottEncoder/images
          - - train_list.txt
            - 20240220_142555_Img_20240220_goods/jsons
            - 20240220_142555_Img_20240220_goods/images
          - - train_list.txt
            - 20240312_210918_prod/jsons
            - 20240312_210918_prod/images
          - - train_list.txt
            - 20240312_210929_prod/jsons
            - 20240312_210929_prod/images
          - - train_list.txt
            - 20240321_162918_Img_20240321_162913/jsons
            - 20240321_162918_Img_20240321_162913/images
          - - train_list.txt
            - 20240321_172502_defectos_rotando/jsons
            - 20240321_172502_defectos_rotando/images
          - - train_list.txt
            - 20240805/jsons
            - 20240805/images
          val:
          - - val_list.txt
            - 20240219_190526_Img_20240219_NaranjaRottEncoder/jsons
            - 20240219_190526_Img_20240219_NaranjaRottEncoder/images
          - - val_list.txt
            - 20240220_142555_Img_20240220_goods/jsons
            - 20240220_142555_Img_20240220_goods/images
          - - val_list.txt
            - 20240312_210918_prod/jsons
            - 20240312_210918_prod/images
          - - val_list.txt
            - 20240312_210929_prod/jsons
            - 20240312_210929_prod/images
          - - val_list.txt
            - 20240321_162918_Img_20240321_162913/jsons
            - 20240321_162918_Img_20240321_162913/images
          - - val_list.txt
            - 20240321_172502_defectos_rotando/jsons
            - 20240321_172502_defectos_rotando/images
          - - val_list.txt
            - 20240805/jsons
            - 20240805/images
        model:
          defect_types:
          - Pedunculo
          - Contraped
          num_channels_input: 5
          model_version: 50
        train:
          initial_model:
          batch_size: 40
          in_memory: false
          num_workers: 10
          epochs: 60
          unfreeze_epoch: 6
          warmup: 3
          learning_rate: 0.002
          optimizer: adam
          gamma_param: 0.1
          label_smoothing: 0.1
          p_dropout: 0.5
          weights_decay: 0.001
          output:
            model_file: orange_seg_ped_cped.pkl
            path: out_models
          min_defect_area: 50
          constrain_weight: 5.0
          min_negative_fraction: 0.95
          bottom_constrain_weight: 1.0
          binmask_weight: 30.0
          class_weights:
          - 1.0
          - 1.0
          logname: orange_mil_segmentation
          wandb_project: DVC_orange_segmentation
          log_cimg: data/test/log_cimg/im_log.cimg
          augmentation:
            random_rotation: 30
            brightness:
            - 0.8
            - 1.4
            contrast:
            - 0.8
            - 1.55
            hue: 0.01
            saturation: 0.15
            blur:
            - 0.1
            - 1.5
            affine:
              scale:
              - 0.7
              - 1.1
              shear: 15
              translate:
              - 0.15
              - 0.15
              degrees: 30
    outs:
    - path: out_models/orange_seg_ped_cped.pkl
      hash: md5
      md5: 71528f5dc51f94734065e437792ad941
      size: 262701680
